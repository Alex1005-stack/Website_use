---
title: "Replication and extension of How Chinese Officials Use the Internet to Construct their Public Image by Jennifer Pan"
author: "Alexander Klueber"
date: "4/7/2020"
output: bookdown::pdf_document2
bibliography: Bibliography.bib
citations: natbib
link-citations: true
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)
knitr::write_bib(c("blei", "cai", "horsley", "jiang", "un", "seifert", "pan", "10.2307/24877628", "10.2307/20058957", "10.1177/0894439308327313", "Kalathil_Boas_2003", "LI20051743", "pan2", "R"), "Bibliography.bib", width = 60)

library(viridis)
library(hrbrthemes)
library(ggridges)
library(skimr)
library(tidybayes)
library(rstanarm)
library(tidyverse)
library(stargazer)
library(tinytex)
library(gtable)
library(gt)


```

# Abstract

Pan (2017) shows that the emphasis on Chinese local government websites on either the competence or benevolence of county executives depends on where they are in the political tenure cycle. I was largely able to replicate these results. My extension confirms that this is the most likely explanation for the observed effect by comparing the statistical explanatory power of alternative models (e.g. cultural differences among regions, gender differences, etc.) through the leave one out method. In addition I validate the geographical randomness of the sample through simulations of repeated sampling and the construction of confidence intervals. They corraborate the findings of the paper by confirming the geographic randomness of the sample.


# Introduction 

The paper contributes to a larger discussion around the use of government websites in authroitarian regimes. Emplyoing the example of China it suggests that instead of enhancing transparency (as intended by the central authorities) these websites serve as vehicles of self-promotion and communication between regime insiders. To conclude this, Pan employes a random sample of 100 from 1.92 million county-level government web pages, classifies the messaging on individual sites (informative, competency or benevolence signalling) and regresses their respective frequency on a series of variables, always including their position in the tenure cycle. She concludes that the tenure of the county government officials and their subsequent promotion (a post-treatment variable) were most directive. This suggests the relevance of these websites in promotion decisions and the importance of tenure on the content being signalled. 

To replicate this paper, I used R [@R]. Original data and code of the replication paper are available in the Harvard dataverse.^[https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/2HTWSU] The code for the extension is available at my repo.^[https://github.com/Alex1005-stack/Gov_1006_final_project]

In addition to replicating the result, I am interested to explore whether other explanations than the signalling function within authoritarian regimes may plausibly explain the patterns in competence / benevolence described in the paper. I will explore these alternatives by comparing the explanatory power of the variable categories individually and through a new category: "cultural variations" (includes the macro-region and the county type). Alternative hypothesis conclusively are:
<ol>
1. The benevolence/competence patterns may be explained by regional cultural variations
2. The benevolence/competence patterns may be explained by the resources at disposal to the official
3. The benevolence/competence patterns may be explained by internal peer preferences
4. The benevolence/competence patterns may be explained by characteristics of the prefecture
5. The benevolence/competence patterns may be explained by the individual abilities of the county officials
6. The benevolence/competence patterns may be explained by the immediate career success of county officials
</ol>

The need for such a comparison arises as the statistical signifiance of variables varies between the regressions. Also the number of observations to construct the regressions vary, making a comparison between them impossible. It is surprising that with a random selection of 100 of the 2,787 counties with website, we immediately dismiss another 29 counties in our modelling because of data inavailability and subsequently another ~23 as our regressions get more ambitious (include more variables). In relation to exploring regional cultural diversity, I seek to validate the randomness of the sample selection from a geographical view point.

I find that the regression on tenure cycle is indeed best able to explain the website content. In addition, the relevance for the post-treatment promotion variable corrobates the importance of regime-insider signalling through county websites. This holds true for the signalling of competence and benevolence. Furthermore, basing the sample on the same set of 48 observations does not alter the conclusions we draw. Lastly, the sample that constitutes the basis of this paper is a geographically random representation of the underlying population of counties.

# Literature review

The replication paper aims to contribute to the larger discusison around role of the Internet in authoritarian regimes, especially in China. It is part of a larger shift in embracing the complexity of the role of the internet within these regimes. The discussion moved from the prevailing assumption of the internet's inherent democratic nature, and its ascribed power to undermine authoritarian regimes to a much more nuanced view that emphasises the role of the internet in relation to how it is being employed by governments and people.[@Kalathil_Boas_2003]

While transparency laws are implemented by central authorities with the intention to obtain more information about the performance of local officials, they often turn out to be political instruments for self-promotion among regime insiders (as this paper shows). Research indicates further that the desired transparency does not come to frutition because grievances submitted through these websites are systematically concealed from upper-level authorities when they implicate lower-tier officials or associates connected to lower-tier officials through patronage ties. Information manipulation occurs primarily through omission of wrongdoing rather than censorship or falsification, suggesting that even in the digital age, in a highly determined and capable regime where reports of corruption are actively and publicly voiced, remains challenged to monitor the behavior of regime agents.[@pan2] There is however some disagreement whether creating transparency on local government performance is the primary function of these laws to begin with, or whether they are primarily intended as subtle instruments of online social control through information delivery, agenda setting, and containment of public dissent.[@10.1177/0894439308327313] 

The emphasis of local officials on the communication among insiders are corraborated by field experiments testing the responsiveness of local officials. Tattling to upper levels of government made county governments considerably more responsive to citizen's demands.[@10.2307/24877628] This challenges to some degree earlier findings that the capacity of the central state to monitor and control lower level agents has increased in China as it suggests that some of the efforts to do so have altered the nature of the interaction rather than shifted the power relationships within it.[@10.2307/20058957] 

This isn't necessarily something negative in of itself, as empirical findings suggest that China uses personnel control to induce desirable outcomes, especially economic gains.[@LI20051743] This alludes to an associated discussion around the missapropriation of resources in the service of individual image building. China is an example where the political arrangements have creacted the incentive and the opportunities for irresponsible behaviour among state agents to do so.[@cai]


# Paper Review

The paper analyses how local government officials use the websites they are required to put up due to the central government’s transparency requirements, to engineer their public image. It concludes that the internet becomes a tool for self-promotion in authoritarian regimes. The analysis demonstrates that the websites tend to highlight the competence (achievements) or the benevolence (concern for citizens) of county executives which change based on the tenure of their cycle. The former is more important to officials that are later in their cycle, while the latter is more important to those earlier in the cycle.

The analysis does so by focusing on a random sample of 100 Chinese counties and their websites. They represent 29 Chinese provinces. Based on this sample they estimate the proportion of posts for competence and benevolence by year in office, where group refers to the year, with 95% confidence intervals in lwr and upr. Generated using Hopkins and King (2010) ReadMe software. The authors then conduct a linear regression that regresses a mayor first year or last year binary indicator on  the number of competence metnions on the websites by county which they extend gradually for additional variables in alternative models. The same is then done for benevolence. These variable include: county resources and environmental factors, incentives of county party secretaries, incentives of prefecture party secretary and other prefecture-level characteristics, county executive’s ability, age, and gender, post-treatment variable of whether the county executive was promoted. The authors conclude from the regression that When a county executive is in the last year of office, an additional 15% or so of website content is on average dedicated to claims of competence. Similarly they conclude that When a county executive is in the first year of office, an additional 10% to 15% of website content is on average dedicated to claims of benevolence. Both results are statistically significant at the 0.05 level.


# Replication

## Section 3.1: Website Content

### Figure 1

I have not replicated the figure 1, a map of the various provinces in China and the availability of county government websites in them. This is because this was a manual step in the construction of the paper. I have replicated the data that was used as a basis for that map.

## Section 4.1: Topics

### Table 1

I have generated the underlying data for the table. I have not transferred it into the same table form as outlined in the paper.

## Section 5.3: Predictive Inference

### Table 3: Regression Results: Competence

Replicated the table, except positioning the constant at the bottom of the table

### Table 4: Regression Results: Benevolence

Same as above


# Extension

## Comparison of alternative regression models in explaining competence and benevolence 

One challenge with the regressions is that they are based on a different number of underlying observations. This is because of the data available in relation to the 100 counties selected as a random sample. The number of observations in our sample decreases from 100 to 71 to 70 to 68 to 48.

In a first step I therefore harmonize the regressions by basing them on the same sample throughout - the 48 observations that have all the required data available. I then compare whether the new regressions yield similar results as the regressions in the paper. Only the first four regressions will change (as regressions (5) and (6) in the original paper are already based on the 48 counties). The following tables represent original and new results side by side. The first column being the original results, the second the result based on the 48 counties.

### Competence 
```{r regression_comparison_competence, cache = TRUE, include =FALSE}
# load in 71 counties with over 100 Chinese language web pages, with svm predictions 

bycounty2 <- read.csv("raw-data/predict.csv")

# Dropping all N/As 

bycounty3 <- bycounty2 %>% drop_na()

# Create a statistical summary of the linear regression model that regresses a mayor first year or last year binary indicator on  he number of competence metnions on the websites by county

# Table 3 (1)
linear_1_st <- lm(comp ~ mayor_first + mayor_last, data=bycounty3)  # ALMOST: mayo first yr more compolence

  # Adds county 2009 gdp per capita and proportion of county population over the age of 15 who are illiterate and number of county resident employed in information production, wholesale and retail from the 2010 census and total links found from root url of countyurl and 2009 provincial level expenditure on culture and media multiplied by the ratio of county GDP to province GDP
  
# Table 3 (2)
linear_2_st <- lm(comp ~ mayor_first +mayor_last +X2009_gdppc_cny+X2010_illiterateprop+itemploy + linksall+ county_mediaexp, data=bycounty3)


# Adds whether county party secretary is in first year of office; takes on value of 1 if sec_2011 = 1, 0 otherwise and whether county party secretary is in last year of office; takes on value of 1 if sec_2011 = 1, 0 otherwise
# Table 3 (3)

linear_3_st <- lm(comp ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last, data=bycounty3)


# Adds whether whether prefecture party secretary is in first or last year of office; takes on value of 1 if pref_ps_2011 = 1, 0 otherwise and evel of education of the prefecture party secretary at the end of formal schooling (not education while a government official); 6 = Doctoral degree; 5 = Master's degree; 4 = Bachelor's degree; 3 = degree from junior college; 2 = high school, 1 = lower than junior college and gdp per capita of the prefecture in 2010 

# Table 3 (4)
linear_4_st <- lm(comp ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last + pref_ps_first + pref_ps_last + pref_ps_edulevel + pref_2010_gdppc, data=bycounty3) 


# Replication paper regressions

# Create a statistical summary of the linear regression model that regresses a mayor first year or last year binary indicator on  he number of competence metnions on the websites by county

# Table 3 (1)
linear_1 <- lm(comp ~ mayor_first + mayor_last, data=bycounty2)  # ALMOST: mayo first yr more compolence

  # Adds county 2009 gdp per capita and proportion of county population over the age of 15 who are illiterate and number of county resident employed in information production, wholesale and retail from the 2010 census and total links found from root url of countyurl and 2009 provincial level expenditure on culture and media multiplied by the ratio of county GDP to province GDP
  
# Table 3 (2)
linear_2 <- lm(comp ~ mayor_first +mayor_last +X2009_gdppc_cny+X2010_illiterateprop+itemploy + linksall+ county_mediaexp, data=bycounty2)


# Adds whether county party secretary is in first year of office; takes on value of 1 if sec_2011 = 1, 0 otherwise and whether county party secretary is in last year of office; takes on value of 1 if sec_2011 = 1, 0 otherwise
# Table 3 (3)

linear_3 <- lm(comp ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last, data=bycounty2)


# Adds whether whether prefecture party secretary is in first or last year of office; takes on value of 1 if pref_ps_2011 = 1, 0 otherwise and evel of education of the prefecture party secretary at the end of formal schooling (not education while a government official); 6 = Doctoral degree; 5 = Master's degree; 4 = Bachelor's degree; 3 = degree from junior college; 2 = high school, 1 = lower than junior college and gdp per capita of the prefecture in 2010 

# Table 3 (4)
linear_4 <- lm(comp ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last + pref_ps_first + pref_ps_last + pref_ps_edulevel + pref_2010_gdppc, data=bycounty2) 
```

```{r predictive_inference_competence_stargazer,  results="asis", echo=FALSE}
stargazer(linear_1, linear_1_st, linear_2, linear_2_st, linear_3, linear_3_st,linear_4, linear_4_st, # The various models included in the table
          title="Table 3: Regression Results results based on 48 sample: Competence", # The title of the table
          dep.var.caption = c("Dependent variable: Competence"), # The Caption of the table
          dep.var.labels.include=FALSE, # Don't include dependent variable labels
          no.space=TRUE,
          digits =2, 
          keep.stat="n", # Include number of observation
          table.layout ="=l-s-c-t-a=n", # Detailing table layout according to replication paper (first dependent variable caption, then column headers, then coefficient table, then added lines, then summary statistics, then notes)
          add.lines=list(c("Resource controls",
                           rep("No", 2),rep("Yes",6)),
                        c("Peer controls",
                           rep("No", 4),rep("Yes",4)),
                        c("Prefecture controls",
                           rep("No", 6),rep("Yes",2)),
                        c("Ability controls",
                           rep("No", 8),rep("Yes",0)),
                        c("Career paths controls",
                           rep("No", 8),rep("Yes",0))), # Add lines to describe in categories the series of variables included
                        covariate.labels = c("Beginning Tenure", "End Tenure"),
                        float = FALSE) # Rename coefficient labels

# Note: Default type is Latex
```


### Benevolence

```{r regression_comparison_benevolence, cache = TRUE, include=FALSE}
# Create a statistical summary of the linear regression model that regresses a mayor first year or last year binary indicator on  he number of competence metnions on the websites by county

# Table 3 (1)
linear.1_st <- lm(benev ~ mayor_first + mayor_last, data=bycounty3)  # ALMOST: mayo first yr more compolence

  # Adds county 2009 gdp per capita and proportion of county population over the age of 15 who are illiterate and number of county resident employed in information production, wholesale and retail from the 2010 census and total links found from root url of countyurl and 2009 provincial level expenditure on culture and media multiplied by the ratio of county GDP to province GDP
  
# Table 3 (2)
linear.2_st <- lm(benev ~ mayor_first +mayor_last +X2009_gdppc_cny+X2010_illiterateprop+itemploy + linksall+ county_mediaexp, data=bycounty3)


# Adds whether county party secretary is in first year of office; takes on value of 1 if sec_2011 = 1, 0 otherwise and whether county party secretary is in last year of office; takes on value of 1 if sec_2011 = 1, 0 otherwise
# Table 3 (3)

linear.3_st <- lm(benev ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last, data=bycounty3)


# Adds whether whether prefecture party secretary is in first or last year of office; takes on value of 1 if pref_ps_2011 = 1, 0 otherwise and evel of education of the prefecture party secretary at the end of formal schooling (not education while a government official); 6 = Doctoral degree; 5 = Master's degree; 4 = Bachelor's degree; 3 = degree from junior college; 2 = high school, 1 = lower than junior college and gdp per capita of the prefecture in 2010 

# Table 3 (4)
linear.4_st <- lm(benev ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last + pref_ps_first + pref_ps_last + pref_ps_edulevel + pref_2010_gdppc, data=bycounty3) 

# Replication paper regressions

linear.1 <- lm(benev ~ mayor_first + mayor_last, data=bycounty2)

# Table 4 (2)
linear.2 <- lm(benev ~ mayor_first +mayor_last +X2009_gdppc_cny+X2010_illiterateprop+itemploy + linksall+ county_mediaexp , data=bycounty2)

# Table 4 (3)
linear.3 <- lm(benev ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp  + sec_first + sec_last, data=bycounty2)

# Table 4 (4)
linear.4 <- lm(benev ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp  + sec_first + sec_last + pref_ps_first + pref_ps_last + pref_ps_edulevel + pref_2010_gdppc, data=bycounty2)

```

```{r predictive_inference_benevolence_stargazer,  results="asis", echo=FALSE}
stargazer(linear.1, linear.1_st, linear.2, linear.2_st, linear.3, linear.3_st, linear.4, linear.4_st, # The various models included in the table
          title="Table 4: Regression results based on 48 sample: Benevolence", # The title of the table
          dep.var.caption = c("Dependent variable: Benevolence"), # The Caption of the table
          dep.var.labels.include=FALSE, # Don't include dependent variable labels
          no.space=TRUE,
          digits =2, 
          keep.stat="n", # Include number of observation
          table.layout ="=l-s-m-c-t-a=n", # Detailing table layout according to replication paper (first dependent variable caption, then column headers, then coefficient table, then added lines, then summary statistics, then notes)
          add.lines=list(c("Resource controls",
                           rep("No", 2),rep("Yes",6)),
                        c("Peer controls",
                           rep("No", 4),rep("Yes",4)),
                        c("Prefecture controls",
                           rep("No", 6),rep("Yes",2)),
                        c("Ability controls",
                           rep("No", 8),rep("Yes",0)),
                        c("Career paths controls",
                           rep("No", 8),rep("Yes",0))), # Add lines to describe in categories the series of variables included
                        covariate.labels = c("Beginning Tenure", "End Tenure"),
                        float = FALSE) # Rename coefficient labels

# Note: Default type is Latex
```

When comparing the results, a noteworthy difference in regards to competence is the immediate flip in the sign of the coeffcient on beginning tenure (in regressions (5) and (6) it also is negative in the original paper). While that coefficient isn't statistically significant for any of the regressions, it suggests that the change in the underlying sample is the most likely explanation for the flip rather than the inclusion of further variables.

In a second step, I go through the various regressions seeking to understand whether any of the tested variable classes (resources, peers, prefecture, ability, career path) explain the observed phenomena better than the ones around tenure. I do so by creating a series of new regressions that include only the variables in the respective variable classes. In addition I introduce a new series of classes: cultural variations, that includes the variables macro-region and county type. 

```{r new_regression_comparison_competence, cache = TRUE, include = FALSE}

# Create a statistical summary of the linear regression model that regresses a mayor first year or last year binary indicator on  he number of competence metnions on the websites by county


# Regression 1
linear_1_gl <- stan_glm(comp ~ mayor_first + mayor_last, data=bycounty3)  # ALMOST: mayo first yr more compolence
linear.1_gl <- stan_glm(benev ~ mayor_first + mayor_last, data=bycounty3)  # ALMOST: mayo first yr more compolence


  # Adds county 2009 gdp per capita and proportion of county population over the age of 15 who are illiterate and number of county resident employed in information production, wholesale and retail from the 2010 census and total links found from root url of countyurl and 2009 provincial level expenditure on culture and media multiplied by the ratio of county GDP to province GDP
  
# Regression 2
linear_2_gl <- stan_glm(comp ~ mayor_first +mayor_last +X2009_gdppc_cny+X2010_illiterateprop+itemploy + linksall+ county_mediaexp, data=bycounty3)

linear.2_gl <- stan_glm(benev ~ mayor_first +mayor_last +X2009_gdppc_cny+X2010_illiterateprop+itemploy + linksall+ county_mediaexp, data=bycounty3)


# Adds whether county party secretary is in first year of office; takes on value of 1 if sec_2011 = 1, 0 otherwise and whether county party secretary is in last year of office; takes on value of 1 if sec_2011 = 1, 0 otherwise

# Regression 3

linear_3_gl <- stan_glm(comp ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last, data=bycounty3)
linear.3_gl <- stan_glm(benev ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last, data=bycounty3)


# Adds whether whether prefecture party secretary is in first or last year of office; takes on value of 1 if pref_ps_2011 = 1, 0 otherwise and evel of education of the prefecture party secretary at the end of formal schooling (not education while a government official); 6 = Doctoral degree; 5 = Master's degree; 4 = Bachelor's degree; 3 = degree from junior college; 2 = high school, 1 = lower than junior college and gdp per capita of the prefecture in 2010 

# Regression 4
linear_4_gl <- stan_glm(comp ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last + pref_ps_first + pref_ps_last + pref_ps_edulevel + pref_2010_gdppc, data=bycounty3)
linear.4_gl <- stan_glm(benev ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last + pref_ps_first + pref_ps_last + pref_ps_edulevel + pref_2010_gdppc, data=bycounty3)


# Adds mayor age, mayor gender and mayor education level

# Regression 5
linear_5_gl <- stan_glm(comp ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last + pref_ps_first + pref_ps_last + pref_ps_edulevel + pref_2010_gdppc + mayor_age + mayor_gender + mayor_edulevel, data=bycounty3)
linear.5_gl <- stan_glm(benev ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last + pref_ps_first + pref_ps_last + pref_ps_edulevel + pref_2010_gdppc + mayor_age + mayor_gender + mayor_edulevel, data=bycounty3)


# Adds mayor promotion

# Regression 6
linear_6_gl <- stan_glm(comp ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last + pref_ps_first + pref_ps_last + pref_ps_edulevel + pref_2010_gdppc + mayor_age + mayor_gender + mayor_edulevel+ mayor_promote, data=bycounty3)
linear.6_gl <- stan_glm(benev ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last + pref_ps_first + pref_ps_last + pref_ps_edulevel + pref_2010_gdppc + mayor_age + mayor_gender + mayor_edulevel+ mayor_promote, data=bycounty3)



# Resources
linear_7_gl <- stan_glm(comp ~ X2009_gdppc_cny+X2010_illiterateprop+itemploy + linksall+ county_mediaexp, data=bycounty3)
linear.7_gl <- stan_glm(benev ~ X2009_gdppc_cny+X2010_illiterateprop+itemploy + linksall+ county_mediaexp, data=bycounty3)


# Peers
linear_8_gl <- stan_glm(comp ~ sec_first + sec_last, data=bycounty3)
linear.8_gl <- stan_glm(benev ~ sec_first + sec_last, data=bycounty3)


# Prefecture
linear_9_gl <- stan_glm(comp ~ pref_ps_first + pref_ps_last + pref_ps_edulevel + pref_2010_gdppc, data=bycounty3) 
linear.9_gl <- stan_glm(benev ~ pref_ps_first + pref_ps_last + pref_ps_edulevel + pref_2010_gdppc, data=bycounty3) 


# Ability
linear_10_gl <- stan_glm(comp ~ mayor_age + mayor_gender + mayor_edulevel, data=bycounty3)
linear.10_gl <- stan_glm(benev ~ mayor_age + mayor_gender + mayor_edulevel, data=bycounty3)


# Career path
linear_11_gl <- stan_glm(comp ~ mayor_promote, data=bycounty3)
linear.11_gl <- stan_glm(benev ~ mayor_promote, data=bycounty3)


# Culture
linear_12_gl <- stan_glm(comp ~ macroregion, data=bycounty3)
linear.12_gl <- stan_glm(benev ~ macroregion, data=bycounty3)

```

Please see graphs and tables for the detailed results of all regressions. Subsequently, only the 3 most relevant models for each regression acc to the loo comparison that is about to follow.

### Competence

#### linear_1_gl
```{r regression_prints_competence_1}
print(linear_1_gl)
```
#### linear_11_gl
```{r regression_prints_competence_11}
print(linear_11_gl)
```
#### linear_8_gl
```{r regression_prints_competence_8}
print(linear_8_gl)
```

### Benevolence

#### linear.1_gl
```{r regression_prints_benevolence_1}
print(linear.1_gl)
```
#### linear.11_gl
```{r regression_prints_benevolence_11}
print(linear.11_gl)
```
#### linear.12_gl
```{r regression_prints_benevolence_12}
print(linear.12_gl)
```

I then compare all the available models with the leave-one-out method to see which one of these has the highest exaplanatory power for the observed phenomena.

### Competence
```{r loo_competence, cache = TRUE, echo=FALSE}
# Leave-one-out cross validation for all prior models
loo_1 <- loo(linear_1_gl, k_threshold = 0.7)
loo_2 <- loo(linear_2_gl, k_threshold = 0.7)
loo_3 <- loo(linear_3_gl, k_threshold = 0.7)
loo_4 <- loo(linear_4_gl, k_threshold = 0.7)
loo_5 <- loo(linear_5_gl, k_threshold = 0.7)
loo_6 <- loo(linear_6_gl, k_threshold = 0.7)
loo_7 <- loo(linear_7_gl, k_threshold = 0.7)
loo_8 <- loo(linear_8_gl, k_threshold = 0.7)
loo_9 <- loo(linear_9_gl, k_threshold = 0.7)
loo_10 <- loo(linear_10_gl, k_threshold = 0.7)
loo_11 <- loo(linear_11_gl, k_threshold = 0.7)
loo_12 <- loo(linear_12_gl, k_threshold = 0.7)

# Compare models 
loo_compare(loo_1, loo_2, loo_3, loo_4, loo_5, loo_6, loo_7, loo_8, loo_9, loo_10, loo_11, loo_12)
```

### Benevolence
```{r loo_benevolence, cache = TRUE, echo=FALSE}
# Leave-one-out cross validation for all prior models
loo.1 <- loo(linear.1_gl, k_threshold = 0.7)
loo.2 <- loo(linear.2_gl, k_threshold = 0.7)
loo.3 <- loo(linear.3_gl, k_threshold = 0.7)
loo.4 <- loo(linear.4_gl, k_threshold = 0.7)
loo.5 <- loo(linear.5_gl, k_threshold = 0.7)
loo.6 <- loo(linear.6_gl, k_threshold = 0.7)
loo.7 <- loo(linear.7_gl, k_threshold = 0.7)
loo.8 <- loo(linear.8_gl, k_threshold = 0.7)
loo.9 <- loo(linear.9_gl, k_threshold = 0.7)
loo.10 <- loo(linear.10_gl, k_threshold = 0.7)
loo.11 <- loo(linear.11_gl, k_threshold = 0.7)
loo.12 <- loo(linear.12_gl, k_threshold = 0.7)

# Compare models 
loo_compare(loo.1, loo.2, loo.3, loo.4, loo.5, loo.6, loo.7, loo.8, loo.9, loo.10, loo.11, loo.12)
```
The comparison suggests that the best models for how competent an official is described as, are the tenure based model employed in the paper and whether officials were promoted in the two ensuing years. The later is a post-treatment variable. Rather than providing additional insights on what the factors around an official are that determine the website content, it suggests the relative importance of the website content in determining whether an individual is promoted. In combination this supports the hypothesis of the author that the websites have an important signalling function within the Chinese state apparatus to determine who gets promoted. 


## Validating geographic split of sample

Subsequently I am simulating repeated sampling. I do so by creating a function that allows me to draw 100 and 48 random samples from the underlying countywebsites (countyweb). I repeat this step 10000 times, counting the number of counties from each province. I then compare that count with the count of counties in the paper samples (the sample of 100 and the 48 counties we actually end up constructing a model with). 

### Random sample of 100
```{r function_100}
countyweb <- read.csv("raw-data/countywebsites.csv")
county100 <- read.csv("raw-data/countywebsites_sampled100.csv", sep="\t") # 100 counties

# function to draw a random samples of size 100 from countyweb and save provinces as names

x <- sample_n(countyweb, 100)

county100_sim <- function(){
  
  x <- sample_n(countyweb, 100)
  list(x$Province)
}

# Count the number of times each province occurs 

calc_provinces <- function(sample){
  
  # Given a sample --- a vector of length 100 with provinces in a random order --- how often does each province occur?
  stopifnot(is.list(sample))
  plan <- unlist(sample)
  
  stopifnot(length(plan) == 100)
  stopifnot(all(plan %in% c("Heilongjiang", "Jilin", "Liaoning", "Qinghai", "Gansu", "Shaanxi", "Shanxi", "Hebei", "Sichuan", "Hubei", "Henan", "Shandong", "Anhui", "Jiangsu", "Yunnan", "Guizhou", "Hunan", "Jiangxi", "Zhejiang", "Hainan", "Guangdong", "Fujian", "Beijing", "Tianjin", "Chongqing", "Shanghai", "Xinjiang", "Inner Mongolia", "Tibet", "Ningxia", "Guangxi")))

  provinces <- c("Heilongjiang", "Jilin", "Liaoning", "Qinghai", "Gansu", "Shaanxi", "Shanxi", "Hebei", "Sichuan", "Hubei", "Henan", "Shandong", "Anhui", "Jiangsu", "Yunnan", "Guizhou", "Hunan", "Jiangxi", "Zhejiang", "Hainan", "Guangdong", "Fujian", "Beijing", "Tianjin", "Chongqing", "Shanghai", "Xinjiang", "Inner Mongolia", "Tibet", "Ningxia", "Guangxi")
  
  provinces_count <- c(1:31)
  
  for (i in 1:31){
  provinces_count[i] <- sum(plan == provinces[i])
  }
  
  provinces_out <- data.frame(provinces, provinces_count)
  return(provinces_out)
}
```

```{r simulation_100, cache = TRUE}
# Create tibble that contains a thousand repetition of the sampling  

sim <- 
  tibble(replication = 1:10000) %>% 
  mutate(sample_provinces = map(replication, ~ county100_sim())) %>%
  mutate(provinces = map(sample_provinces, ~ calc_provinces(.)))  %>%
  select(-sample_provinces)

sim_2 <- sim %>% unnest(cols = c(provinces)) 

sim_2 <- sim_2[order(sim_2$provinces),]

provinces_100 <- county100 %>% group_by(province_en) %>% count()

provinces <- c("Heilongjiang", "Jilin", "Liaoning", "Qinghai", "Gansu", "Shaanxi", "Shanxi", "Hebei", "Sichuan", "Hubei", "Henan", "Shandong", "Anhui", "Jiangsu", "Yunnan", "Guizhou", "Hunan", "Jiangxi", "Zhejiang", "Hainan", "Guangdong", "Fujian", "Beijing", "Tianjin", "Chongqing", "Shanghai", "Xinjiang", "Inner Mongolia", "Tibet", "Ningxia", "Guangxi")

provinces_dat <- data.frame(provinces)

provinces_100_all <- provinces_dat %>% 
                  left_join(provinces_100, by = c("provinces" = "province_en")) %>%
                  mutate(Count = ifelse(is.na(n) == TRUE, 0, n)) %>%
                  select(-n)

provinces_100_all <- provinces_100_all[order(provinces_100_all$provinces),] %>%
                    mutate(Number = 1:31)
```
```{r graph_100}
# Create a graph 

Extension_graph_1 <- sim_2 %>% 
  ggplot(aes(x = provinces_count, y = provinces, fill = provinces)) + 
  geom_density_ridges(rel_min_height = 0.01, scale = 2, alpha = 0.7, size = 0.3, panel_scaling = FALSE) +
  labs(title = "Frequency distr of counties per province in sample of 100",
         subtitle = "Geographic distribution of the paper sample acc to 10000 repeated samples",
         caption = "Data from Replication Paper",
         x = "No of counties in province",
         y = "Provinces")+
  theme_ridges() +
  scale_fill_cyclical(values = c("blue", "green"))+
    theme(
      legend.position="none",
      panel.spacing = unit(0.1, "lines"),
      axis.text.x = element_text(size=10, angle = 270)
    )+
  xlim(0, 13)+
  geom_segment(data = provinces_100_all, aes(x = Count, xend = Count, y = Number, yend = Number+1), color = "red") + 
  coord_flip()

Extension_graph_1
```


```{r CI_100}
# Create 95% CI intervals and check for which ones the observed frequency count is outside the 95% CI interval

sim_3 <- sim_2 %>%
  group_by(provinces) %>%
  summarize(CI_lower = quantile(provinces_count, .025),
            CI_upper = quantile(provinces_count, .975)) %>%
  left_join(provinces_100_all, by = c("provinces", "provinces")) %>%
  mutate(`Outside CI` = ifelse(Count > CI_upper | Count < CI_lower, "Yes", "No")) %>%
  select(-Number)

# Create gt table

gt_table_2 <- 
  sim_3 %>%
  gt(
    rowname_col = "Provinces",
    groupname_col = "Confidence Intervals"
  )

Extension_Table_1 <- gt_table_2 %>% 
  tab_stubhead(label = "Provinces") %>%
  tab_header(
    title = "Extension Table 1: Frequency of provinces in sample of 100",
    subtitle = "Based on simulation of 10000 samples of 100") %>%
  cols_align("center") %>%
  cols_label(
    provinces = "Provinces",
    CI_upper = "97.5 Percentile",
    CI_lower = "2.5 Percentile",
    Count = "Frequency in paper sample"
  )

Extension_Table_1
```

Repeated simulated sampling allows us to conclude that the sample of 100 in the paper is random and thereby representative in terms of geographic sampling. This is because the number of counties from a province in no case is outside the 95% CI interval that we constructed. The graph shows that in some counties, s.a. Heilongjiang or Hennan the county occurences are rather on the margins of what we would expect to see.   

### Sample of 48 for modelling

```{r function_48}
# function to draw a random samples of size 48 from countyweb and save provinces as names

county48_sim <- function(){
  
  x48 <- sample_n(countyweb, 48)
  list(x48$Province)
}
# Count the number of times each province occurs 

calc_provinces_48 <- function(sample){
  
  # Given a sample --- a vector of length 100 with provinces in a random order --- how often does each province occur?
  stopifnot(is.list(sample))
  plan <- unlist(sample)
  
  stopifnot(length(plan) == 48)
  stopifnot(all(plan %in% c("Heilongjiang", "Jilin", "Liaoning", "Qinghai", "Gansu", "Shaanxi", "Shanxi", "Hebei", "Sichuan", "Hubei", "Henan", "Shandong", "Anhui", "Jiangsu", "Yunnan", "Guizhou", "Hunan", "Jiangxi", "Zhejiang", "Hainan", "Guangdong", "Fujian", "Beijing", "Tianjin", "Chongqing", "Shanghai", "Xinjiang", "Inner Mongolia", "Tibet", "Ningxia", "Guangxi")))

  provinces <- c("Heilongjiang", "Jilin", "Liaoning", "Qinghai", "Gansu", "Shaanxi", "Shanxi", "Hebei", "Sichuan", "Hubei", "Henan", "Shandong", "Anhui", "Jiangsu", "Yunnan", "Guizhou", "Hunan", "Jiangxi", "Zhejiang", "Hainan", "Guangdong", "Fujian", "Beijing", "Tianjin", "Chongqing", "Shanghai", "Xinjiang", "Inner Mongolia", "Tibet", "Ningxia", "Guangxi")
  
  provinces_count <- c(1:31)
  
  for (i in 1:31){
  provinces_count[i] <- sum(plan == provinces[i])
  }
  
  provinces_out <- data.frame(provinces, provinces_count)
  return(provinces_out)
}
```

```{r simulation_48, cache = TRUE}
# Create tibble that contains a thousand repetition of the sampling  

sim48 <- 
  tibble(replication = 1:10000) %>% 
  mutate(sample_provinces = map(replication, ~ county48_sim())) %>%
  mutate(provinces = map(sample_provinces, ~ calc_provinces_48(.)))  %>%
  select(-sample_provinces)

sim_48_2 <- sim48 %>% unnest(cols = c(provinces)) 

sim_48_2 <- sim_48_2[order(sim_48_2$provinces),]
```

```{r graph_48}

# Count number of counties in paper sample
provinces_48 <- bycounty3 %>% group_by(province_en) %>% count()

provinces_dat_48 <- data.frame(provinces)

provinces_48_all <- provinces_dat_48 %>% 
                  left_join(provinces_48, by = c("provinces" = "province_en")) %>%
                  mutate(Count = ifelse(is.na(n) == TRUE, 0, n)) %>%
                  select(-n)

provinces_48_all <- provinces_48_all[order(provinces_48_all$provinces),] %>%
                    mutate(Number = 1:31)

# Create a graph 

Extension_graph_2 <- sim_48_2 %>% 
  ggplot(aes(x = provinces_count, y = provinces, fill = provinces)) + 
  geom_density_ridges(rel_min_height = 0.01, scale = 2, alpha = 0.7, size = 0.3, panel_scaling = FALSE) +
  labs(title = "Frequency distr of counties per province in sample of 48",
         subtitle = "Geographic distribution of the paper sample acc to 10000 repeated samples",
         caption = "Data from Replication Paper",
         x = "No of counties in province",
         y = "Provinces")+
  theme_ridges() +
  scale_fill_cyclical(values = c("blue", "green"))+
    theme(
      legend.position="none",
      panel.spacing = unit(0.1, "lines"),
      axis.text.x = element_text(size=10, angle = 270)
    )+
  xlim(0, 7)+
  geom_segment(data = provinces_48_all, aes(x = Count, xend = Count, y = Number, yend = Number+1), color = "red") + 
  coord_flip()

Extension_graph_2
```

```{r CI_48}
# Create 95% CI intervals and check for which ones the observed frequency count is outside the 95% CI interval

sim_48_3 <- sim_48_2 %>%
  group_by(provinces) %>%
  summarize(CI_lower = quantile(provinces_count, .025),
            CI_upper = quantile(provinces_count, .975)) %>%
  left_join(provinces_48_all, by = c("provinces", "provinces")) %>%
  mutate(`Outside CI` = ifelse(Count > CI_upper | Count < CI_lower, "Yes", "No"),
         `On lower CI boundary` = ifelse(Count == CI_lower, "Yes", "No")) %>%
  select(-Number)

# Create gt table

gt_table_3 <- 
  sim_48_3 %>%
  gt(
    rowname_col = "Provinces",
    groupname_col = "Confidence Intervals"
  )

Extension_Table_2 <- gt_table_3 %>% 
  tab_stubhead(label = "Provinces") %>%
  tab_header(
    title = "Extension Table 2: Frequency of provinces in sample of 48",
    subtitle = "Based on simulation of 10000 samples of 48") %>%
  cols_align("center") %>%
  cols_label(
    provinces = "Provinces",
    CI_upper = "97.5 Percentile",
    CI_lower = "2.5 Percentile",
    Count = "Frequency in paper sample"
  )

Extension_Table_2
```

Repeated simulated sampling allows us to conclude that the sample of 48 in the paper is likely random and thereby representative in terms of geographic sampling. This is because the number of counties from a province in only one case (Zhejiang) is outside the 95% CI interval that we constructed. The graph shows that there is a surprising amount of states at the lower boundary of 0. This seems plausible due to the small size of the sample (Beijing, Hainan, Henan, Jilin, Liaoning, Ningxia, Qinghai and Tibet). There seems to be no regional pattern among these states (3 East, 2 Central, 3 West).

# Conclusion

The paper highlights the us of county websites as signalling vehicles among regime insiders. Pan suggests this based on the explanatory power of the tenure cycle of county officials and the content that is being signaled. 

To replicate this paper, I used R [@R]. Original data and code of the replication paper are available in the Harvard dataverse.^[https://dataverse.harvard.edu/dataset.xhtml?persistentId=doi:10.7910/DVN/2HTWSU] The code for the extension is available at my repo.^[https://github.com/Alex1005-stack/Gov_1006_final_project]

In addition, I confirmed that no other categories of variables available in relation to the county websites is able to explain these patterns better. These categories included:
<ol>
1. The benevolence/competence patterns may be explained by regional cultural variations
2. The benevolence/competence patterns may be explained by the resources at disposal to the official
3. The benevolence/competence patterns may be explained by internal peer preferences
4. The benevolence/competence patterns may be explained by characteristics of the prefecture
5. The benevolence/competence patterns may be explained by the individual abilities of the county officials
6. The benevolence/competence patterns may be explained by the immediate career success of county officials
</ol>

In relation to exploring regional cultural diversity, I furthermore validated the randomness of the sample selection from a geographical view point.

In conclusion, my findings confirm that the regression on tenure cycle among the available categories of data is best able to explain the website content. In line with the larger narrative of the paper, the post-treatment promotion variable suggests the relative importance of website contents in relation to promotion decisions. Using the subset of 48 observations consistently, does not alter these conclusions. Lastly, the sample that constitutes the basis of this paper is a geographically random representation of the underlying counties.

# Tables and Figures

Below tables show the coefficients regressing a series of variables onto the number of competence mentions on the county government website. They compare a series of old regressions (using a diverging subset of the 100 county sample as the basis for the regression) with a series of new regressions (using the same 48 counties as the basis for all regressions and including a series of new regressions)   

```{r t_f1, results="asis"}
stargazer(linear_1, linear_1_st, linear_2, linear_2_st, linear_3, linear_3_st,linear_4, linear_4_st, # The various models included in the table
          title="Table 3: Regression Results results based on 48 sample: Competence", # The title of the table
          dep.var.caption = c("Dependent variable: Competence"), # The Caption of the table
          dep.var.labels.include=FALSE, # Don't include dependent variable labels
          no.space=TRUE,
          digits =2, 
          keep.stat="n", # Include number of observation
          table.layout ="=l-s-c-t-a=n", # Detailing table layout according to replication paper (first dependent variable caption, then column headers, then coefficient table, then added lines, then summary statistics, then notes)
          add.lines=list(c("Resource controls",
                           rep("No", 2),rep("Yes",6)),
                        c("Peer controls",
                           rep("No", 4),rep("Yes",4)),
                        c("Prefecture controls",
                           rep("No", 6),rep("Yes",2)),
                        c("Ability controls",
                           rep("No", 8),rep("Yes",0)),
                        c("Career paths controls",
                           rep("No", 8),rep("Yes",0))), # Add lines to describe in categories the series of variables included
                        covariate.labels = c("Beginning Tenure", "End Tenure"),
                        float = FALSE) # Rename coefficient labels
```


Below tables show the coefficients regressing a series of variables onto the number of benevolence mentions on the county government website. They compare a series of old regressions (using a diverging subset of the 100 county sample as the basis for the regression) with a series of new regressions (using the same 48 counties as the basis for all regressions and including a series of new regressions)   

```{r t_f2, results="asis"}
stargazer(linear.1, linear.1_st, linear.2, linear.2_st, linear.3, linear.3_st, linear.4, linear.4_st, # The various models included in the table
          title="Table 4: Regression results based on 48 sample: Benevolence", # The title of the table
          dep.var.caption = c("Dependent variable: Benevolence"), # The Caption of the table
          dep.var.labels.include=FALSE, # Don't include dependent variable labels
          no.space=TRUE,
          digits =2, 
          keep.stat="n", # Include number of observation
          table.layout ="=l-s-m-c-t-a=n", # Detailing table layout according to replication paper (first dependent variable caption, then column headers, then coefficient table, then added lines, then summary statistics, then notes)
          add.lines=list(c("Resource controls",
                           rep("No", 2),rep("Yes",6)),
                        c("Peer controls",
                           rep("No", 4),rep("Yes",4)),
                        c("Prefecture controls",
                           rep("No", 6),rep("Yes",2)),
                        c("Ability controls",
                           rep("No", 8),rep("Yes",0)),
                        c("Career paths controls",
                           rep("No", 8),rep("Yes",0))), # Add lines to describe in categories the series of variables included
                        covariate.labels = c("Beginning Tenure", "End Tenure"),
                        float = FALSE) # Rename coefficient labels

```


This table compares and ranks them in order of their statistical explanatory power using the leave one out method.

Competence:

```{r t_f3}
loo_compare(loo_1, loo_2, loo_3, loo_4, loo_5, loo_6, loo_7, loo_8, loo_9, loo_10, loo_11, loo_12)
```

Benevolence:

```{r t_f4}
loo_compare(loo.1, loo.2, loo.3, loo.4, loo.5, loo.6, loo.7, loo.8, loo.9, loo.10, loo.11, loo.12)
```

Printing all regressions and their results from extension

Competence
```{r t_f5}
print(linear_1_gl)
print(linear_2_gl)
print(linear_3_gl)
print(linear_4_gl)
print(linear_5_gl)
print(linear_6_gl)
print(linear_7_gl)
print(linear_8_gl)
print(linear_9_gl)
print(linear_10_gl)
print(linear_11_gl)
print(linear_12_gl)
```

Benevolence 

```{r t_f6}
print(linear.1_gl)
print(linear.2_gl)
print(linear.3_gl)
print(linear.4_gl)
print(linear.5_gl)
print(linear.6_gl)
print(linear.7_gl)
print(linear.8_gl)
print(linear.9_gl)
print(linear.10_gl)
print(linear.11_gl)
print(linear.12_gl)
```

Drawing 10,000 repeated samples of 100 counties from the list of all county government websites, we graph the distribution of how many of the counties in the sample are in a particular province for all 31 provinces included in the original data set. The red lines indicate how many counties in a particular province were included the sample employed by the paper. 

```{r t_f7}
Extension_graph_1
```

Based on the logic described above, the table then shows the limits of the 95% confidence intervals for that frequency and whether the observed frequency in the paper were outside these limits (0 counties).

```{r t_f8}
Extension_Table_1
```

Drawing 10,000 repeated samples of 48 counties from the list of all county government websites, we graph the distribution of how many of the counties in the sample are in a particular province for all 31 provinces included in the original data set. The red lines indicate how many counties in a particular province were included the sample employed by the paper. 

```{r t_f9}
Extension_graph_2
```

Based on the logic described above, the table then shows the limits of the 95% confidence intervals for that frequency and whether the observed frequency in the paper were outside these limits (1 county) or on the lower boundary (8 counties).

```{r t_f10}
Extension_Table_2
```

# Appendixes 

## Section 3.1: Website Content

### Figure 1: County Government Website Availability by Province

```{r section_3_1_website_content_figure_1, include= FALSE}

# loading in the countywebsites data set (which lists the websites for all chinese counties that had them in place (2,867 counties))

countyweb <- read.csv("raw-data/countywebsites.csv") 


# Returning the dimensions in the data set (2,867 lines (counties) and 5 variables)

  #dim(countyweb) #2,867 counties


# Filtering out the counties for which there is no website and assigning them to a data frame called countyweb_na

countyweb_na <- countyweb[countyweb$Website == "",]


# Counting the number of counties in that data frame

  #dim(countyweb_na) # 80 counties without websites


# Counting the number of counties that have websites by subtracting the first dimension of the countyweb_na (that contains the counties that do not have a website) data frame from the first dimension of all counties included in the countyweb data frame

  #dim(countyweb)[1] - dim(countyweb_na)[1]  # 2,787 counties with websites

# Counting the number of provinces represented through the 80 counties by counting the length of a vector that includes only the unique provinces in the countyweb_na data frame 

  #length(unique(countyweb_na$Province)) # 80 counties in 20 provinces


# Fig 1: Proportion of counties without websites by province
# Creating the prportion of counties without website in all provinces by dividing the tabled number of rows in a province from the countyweb_na data frame by the tabled number of rows in a province from the data frame that includes all counties

table(countyweb_na$Province) / table(countyweb$Province)
```

```{r section_3_1_website_content_sample, include= FALSE}
# 100 randomly sampled counties
# Loading in a random sample of 100 county websites, that are separated by a tab

county100 <- read.csv("raw-data/countywebsites_sampled100.csv", sep="\t") 


# Listing the column names of this sample

  # colnames(county100)


# Counting the number of provinces represented through the 100 random counties by counting the length of a vector that includes only the unique provinces in the countyweb_na data frame 

  # length(unique(county100$province_en))  # 100 counties in 29 provinces


# Building a count table of the two different county types (county-level cities or counties and districts)

  # table(county100$countytype) # 61 are county-level cities or counties, 39 are districts


# Building a count table of the three different macro-regions (Central, East, West)

  # table(county100$macroregion) # 34 in West China, 31 in Central, 35 in East


# For the random sample of 100, summing up the total number of links found from root url of countyurl across all counties, removing missing values with na.rm = TRUE 

  # sum(county100$linksall, na.rm=T) #2,015,061 links among all 100


# For the random sample of 100, summing up the total number of links found from root url of countyurl that were internal to website across all counties, removing missing values with na.rm = TRUE

  # sum(county100$linksint, na.rm=T) # 1,547,239 internal links


# Getting a summary of descriptive statistics for the number of links internal to the website in the random sample of 100 counties, given that they had more than 0 internal links, indicating a range from 49 to 162403 internal links

  # summary(county100$linksint[county100$linksint >0]) # range from 49 to 162,400, for website where links could be obtained


# Number of websites that had more than 100 scraped links that contained chinese text in a count table 

  # table(county100$links_chtxt > 100) # 71 counties with >100 Chinese web pages

```

## Section 4.1: Topics

### Table 1: LDA topics and OGI Requirements

```{r section_4_1_topics_table_1, include= FALSE}
# Loading in output of LDA topic model, including topic number (topic), hand label (label), corresponding ogi category (obi), and the top 50 words in Chinese with the word frequency (word1, word2, etc.), separating the columns by tabs

topics <- read.csv("raw-data/topics.csv",stringsAsFactors=F, sep="\t")


# listing the column headers of the topics data frame

  # colnames(topics)


# Counting the number of dimensions in the data set (50 different topics)

  # dim(topics)  # 50 topics


# Create count table of number of topics that were unable to label (11) vs. 39 that were able to lable

  # table(topics$label == "unable to label")  # could lable 39 topics

# Table 1
# Looking at the topics that are included under the respective ogi clusters

print("OGI: administrative rules and regulations")
topics$label[topics$ogi=="administrative rules and regulations"]

print("OGI: economic development plans")
topics$label[topics$ogi=="economic development plans"]

print("OGI: statistical information")
topics$label[topics$ogi=="statistical information"]

print("OGI: budgets and financial accounts")
topics$label[topics$ogi=="budgets and financial accounts"]

print("OGI: procurement standards")
topics$label[topics$ogi=="procurement standards"]

print("OGI: administrative licensing")
topics$label[topics$ogi=="administrative licensing"]

print("OGI: major construction projects")
topics$label[topics$ogi=="major construction projects"]

print("OGI: land acquisition and housing demolition")
topics$label[topics$ogi=="land acquisition and housing demolition"]

print("OGI: poverty alleviation, education, health care, social security, employment")
topics$label[topics$ogi=="poverty alleviation, education, health care, social security, employment"]

print("OGI: emergency management plans")
topics$label[topics$ogi=="emergency management plans"]

print("OGI: environment, product quality and supervision")
topics$label[topics$ogi=="environment, product quality and supervision"]

print("OGI: other")
topics$label[topics$ogi=="other"]
```

## Section 5.1: Measuring Tenure

### Table 2: Distribution of Year in office

```{r section_5_1_measuring_tenure_table_2, include= FALSE}
county100 <- read.csv("raw-data/countywebsites_sampled100.csv", sep="\t") 

# Table 2: Distribution of Year in Office
# Creating a count table based of the number of counties in which the mayor has been in office for a certain number of years ( 1- 6 years)

distr <- county100 %>%
  group_by(mayor_tenure2) %>%
  summarise(`Number of Counties` = n()) %>%
  drop_na()

prop <- county100 %>%
  group_by(mayor_tenure2, mayor_status) %>%
  summarise(`Number of Counties` = n()) %>%
  drop_na()%>%
  spread(key = mayor_status, value = `Number of Counties`) %>%
  mutate(`in office` = ifelse(is.na(`in office`), 0 , `in office`),
         promotion = ifelse(is.na(promotion), 0 , promotion),
         retired_demoted = ifelse(is.na(retired_demoted), 0 , retired_demoted),
          Total = `in office`+ promotion + retired_demoted,
         `Stayed in Same Position` = round(`in office`/Total,2),
          Promoted = round(promotion/Total,2),
          `Retired or Demoted` = round(retired_demoted/Total,2)) %>%
  select(`Stayed in Same Position`, Promoted, `Retired or Demoted`, mayor_tenure2)
  
table <- bind_cols(prop, distr) %>%
        select (-mayor_tenure21)

gt_table <- 
  table %>%
  gt(
    rowname_col = "mayor_tenure2",
    groupname_col = "group"
  )


gt_table %>% 
  tab_stubhead(label = "Years in Office") %>%
  tab_header(
    title = "Table 2: Distribution of Year in office",
    subtitle = "Based on sample of 100 counties") %>%
  fmt_percent(
    columns = vars("Stayed in Same Position", "Promoted", "Retired or Demoted"),
    decimals = 0) %>%
  cols_align("center")

```

## Section 5.2: Descriptive Results

### Figure 2: Proportion of web pages with content focused on competence by year in office...

```{r section_5_2_descriptive_results_figure_2, include= FALSE}
# Replicating Figure 2 on page 15 of the paper 

# Loading in statistical analysis estimating the competence/benevolence level and lower and upper boundaries based on how many years an official has been in office 
# readme_out_yroff.csv: estimated proportion of posts for competence and benevolence by year in office, where group refers to the year, with 95% confidence intervals in lwr and upr. Generated using Hopkins and King (2010) ReadMe software

yroff <- read.csv("raw-data/readme_out_yroff.csv", header=TRUE)


# Loading in statistical analysis estimating the competence/benevolence level and lower and upper boundaries based on the proximity to tenure

# readme_out_tenure.csv: estimated proportion of posts for competence and benevolence by proximity to leaving office, where group = 1 refers beginning of tenure, group = 2 to middle of tenure, and group = 3 to end of tenure; 95% confidence intervals in lwr and upr. Generated using Hopkins and King (2010) ReadMe software

tenure <- read.csv("raw-data/readme_out_tenure.csv", header=TRUE)


# Defining y axis

yaxtloc <- c(0,.1,.2,.3,.4,.5)


# Labeling y axis

laxtlab <- c("0%", "10%","20%","30%","40%","50%")


# Defining x axis

xaxtloc <- c(0,.2,.4,.6,.8,1)


# Labeling x axis

lxaxtlab <- c("Beginning", "Middle","End")


# Fig 3: Proportion of web pages with content focused on competence   

# Setting the layout parameters in terms of how much they ought to be magnified in comparison to the defaul for the graph as 1,2 

par(mfrow=c(1,2)) 

# Creating a plot containing all x values from 1 to 5 years of office, and the respective estimate values as the dots in the graph, setting the y axis to run from 0 to 50%, setting the size of the dots to 16 and defining the x and y labels, the width a and the size of the ticks on c and y axis and the labels

plot(1:5, yroff[1:5,]$estimate,ylim=c(0,0.5), pch=16,xlab="Year in Office",ylab="% Web Pages for Competence",cex=1.5, cex.axis=1.5, cex.lab=1.5,yaxt="n")
axis(2, at= yaxtloc,labels= laxtlab, cex.axis=1.5)

# Using a loop to add the upper and lower boundaries of width 2 for each of the years in office (1-5)

for(i in 1:5){
	segments(i,yroff[i,]$lwr,i,yroff[i,]$upr, lwd=2)
}


# Creating a plot containing all x values from 1 to 3 proximity to tenure, and the respective estimate values as the dots in the graph, setting the y axis to run from 0 to 50%, setting the size of the dots to 16 and defining the x and y labels, the width a and the size of the ticks on c and y axis and the labels

plot(1:3, tenure[1:3,]$estimate,ylim=c(0,0.5), pch=16,xlab="Proximity to Leaving Office",ylab="% Web Pages for Competence",cex=1.5, cex.axis=1.5, cex.lab=1.5,xaxt="n",xlim=c(0.8,3.2),yaxt="n")
axis(2, at= yaxtloc,labels= laxtlab, cex.axis=1.5)
axis(1,at=c(1,2,3),labels= lxaxtlab,cex.axis=1.5)


# Using a loop to add the upper and lower boundaries of width 2 for each of the proximities to tenure (1-3)

for(i in 1:3){
	segments(i,tenure[i,]$lwr,i,tenure[i,]$upr, lwd=2)
}

```

### Figure 3: Proportion of web pages with content focused on belevolence by year in office...

```{r section_5_2_descriptive_results_figure_3, include= FALSE}
# Fig 4: Proportion of web pages with content focused on benevolence

# Setting the layout parameters in terms of how much they ought to be magnified in comparison to the defaul for the graph as 1,2 

par(mfrow=c(1,2)) 


# Creating a plot containing all x values from 1 to 5 years of office, and the respective estimate values as the dots in the graph, setting the y axis to run from 0 to 50%, setting the size of the dots to 16 and defining the x and y labels, the width a and the size of the ticks on c and y axis and the labels

plot(1:5, yroff[6:10,]$estimate,ylim=c(0,0.5), pch=16,xlab="Year in Office",ylab="% Web Pages for Benevolence",cex=1.5, cex.axis=1.5, cex.lab=1.5,yaxt="n")
axis(2, at= xaxtloc,labels= laxtlab, cex.axis=1.5)


# Using a loop to add the upper and lower boundaries of width 2 for each of the years in office (1-5)

for(i in 1:5){
	segments(i,yroff[i+5,]$lwr,i,yroff[i+5,]$upr, lwd=2)
}


# Creating a plot containing all x values from 1 to 3 proximity to tenure, and the respective estimate values as the dots in the graph, setting the y axis to run from 0 to 50%, setting the size of the dots to 16 and defining the x and y labels, the width a and the size of the ticks on c and y axis and the labels

plot(1:3, tenure[4:6,]$estimate,ylim=c(0,0.5), pch=16,xlab="Proximity to Leaving Office",ylab="% Web Pages for Benevolence",cex=1.5, cex.axis=1.5, cex.lab=1.5,xaxt="n",xlim=c(0.8,3.2),yaxt="n")
axis(2, at= yaxtloc,labels= laxtlab, cex.axis=1.5)
axis(1,at=c(1,2,3),labels= lxaxtlab,cex.axis=1.5)


# Using a loop to add the upper and lower boundaries of width 2 for each of the proximities to tenure (1-3)

for(i in 1:3){
	segments(i,tenure[i+3,]$lwr,i,tenure[i+3,]$upr, lwd=2)
}
```

## Section 5.3: Predictive Inference

### Table 3: Regression Results: Competence

```{r section_5_3_predictive_inference_table_3_data, include= FALSE}
# load in 71 counties with over 100 Chinese language web pages, with svm predictions 

bycounty2 <- read.csv("raw-data/predict.csv")


# Create a statistical summary of the linear regression model that regresses a mayor first year or last year binary indicator on  he number of competence metnions on the websites by county

# Table 3 (1)
linear_1 <- lm(comp ~ mayor_first + mayor_last, data=bycounty2)  # ALMOST: mayo first yr more compolence

  # Adds county 2009 gdp per capita and proportion of county population over the age of 15 who are illiterate and number of county resident employed in information production, wholesale and retail from the 2010 census and total links found from root url of countyurl and 2009 provincial level expenditure on culture and media multiplied by the ratio of county GDP to province GDP
  
# Table 3 (2)
linear_2 <- lm(comp ~ mayor_first +mayor_last +X2009_gdppc_cny+X2010_illiterateprop+itemploy + linksall+ county_mediaexp, data=bycounty2)


# Adds whether county party secretary is in first year of office; takes on value of 1 if sec_2011 = 1, 0 otherwise and whether county party secretary is in last year of office; takes on value of 1 if sec_2011 = 1, 0 otherwise
# Table 3 (3)

linear_3 <- lm(comp ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last, data=bycounty2)


# Adds whether whether prefecture party secretary is in first or last year of office; takes on value of 1 if pref_ps_2011 = 1, 0 otherwise and evel of education of the prefecture party secretary at the end of formal schooling (not education while a government official); 6 = Doctoral degree; 5 = Master's degree; 4 = Bachelor's degree; 3 = degree from junior college; 2 = high school, 1 = lower than junior college and gdp per capita of the prefecture in 2010 

# Table 3 (4)
linear_4 <- lm(comp ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last + pref_ps_first + pref_ps_last + pref_ps_edulevel + pref_2010_gdppc, data=bycounty2) 


# Adds mayor age, mayor gender and mayor education level

# Table 3 (5)
linear_5 <- lm(comp ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last + pref_ps_first + pref_ps_last + pref_ps_edulevel + pref_2010_gdppc + mayor_age + mayor_gender + mayor_edulevel, data=bycounty2)


# Adds mayor promotion

# Table 3 (6)
linear_6 <- lm(comp ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last + pref_ps_first + pref_ps_last + pref_ps_edulevel + pref_2010_gdppc + mayor_age + mayor_gender + mayor_edulevel+ mayor_promote, data=bycounty2)

```

```{r section_5_3_predictive_inference_table_3_stargazer,  results="asis", include= FALSE}

stargazer(linear_1, linear_2, linear_3, linear_4, linear_5, linear_6, # The various models included in the table
          title="Table 3: Regression Results: Competence", # The title of the table
          dep.var.caption = c("Dependent variable: Competence"), # The Caption of the table
          dep.var.labels.include=FALSE, # Don't include dependent variable labels
          no.space=TRUE, 
          keep.stat="n", # Include number of observation
          keep = c("mayor_first", "mayor_last", "Constant"),# exclude all variables, except the specified ones
          table.layout ="=l-c-t-a-s=n", # Detailing table layout according to replication paper (first dependent variable caption, then column headers, then coefficient table, then added lines, then summary statistics, then notes)
          add.lines=list(c("Resource controls",
                           rep("No", 1),rep("Yes",5)),
                        c("Peer controls",
                           rep("No", 2),rep("Yes",4)),
                        c("Prefecture controls",
                           rep("No", 3),rep("Yes",3)),
                        c("Ability controls",
                           rep("No", 4),rep("Yes",2)),
                        c("Career paths controls",
                           rep("No", 5),rep("Yes",1))), # Add lines to describe in categories the series of variables included
                        covariate.labels = c("Beginning Tenure", "End Tenure"),
                        float = FALSE) # Rename coefficient labels


# Note: Default type is Latex
```

### Table 4: Regression Results: Benevolence

```{r section_5_3_predictive_inference_table_4_data, include= FALSE}
# Table 4 (1)
linear.1 <- lm(benev ~ mayor_first + mayor_last, data=bycounty2)

# Table 4 (2)
linear.2 <- lm(benev ~ mayor_first +mayor_last +X2009_gdppc_cny+X2010_illiterateprop+itemploy + linksall+ county_mediaexp , data=bycounty2)

# Table 4 (3)
linear.3 <- lm(benev ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp  + sec_first + sec_last, data=bycounty2)

# Table 4 (4)
linear.4 <- lm(benev ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp  + sec_first + sec_last + pref_ps_first + pref_ps_last + pref_ps_edulevel + pref_2010_gdppc, data=bycounty2)

# Table 4 (5)
linear.5 <- lm(benev ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last + pref_ps_first + pref_ps_last + pref_ps_edulevel + pref_2010_gdppc + mayor_age + mayor_gender + mayor_edulevel, data=bycounty2)

# Table 4 (6)
linear.6 <- lm(benev ~ mayor_first + mayor_last + X2009_gdppc_cny + X2010_illiterateprop+itemploy + linksall+ county_mediaexp + sec_first + sec_last + pref_ps_first + pref_ps_last + pref_ps_edulevel + pref_2010_gdppc + mayor_age + mayor_gender + mayor_edulevel+ mayor_promote, data=bycounty2)

```


```{r section_5_3_predictive_inference_table_4_stargazer,  results="asis", include=FALSE}

stargazer(linear.1, linear.2, linear.3, linear.4, linear.5, linear.6, # The various models included in the table
          title="Table 3: Regression Results: Benevolence", # The title of the table
          dep.var.caption = c("Dependent variable: Benevolence"), # The Caption of the table
          dep.var.labels.include=FALSE, # Don't include dependent variable labels
          no.space=TRUE, 
          keep.stat="n", # Include number of observation
          keep = c("mayor_first", "mayor_last", "Constant"),# exclude all variables, except the specified ones
          table.layout ="=l-c-t-a-s=n", # Detailing table layout according to replication paper (first dependent variable caption, then column headers, then coefficient table, then added lines, then summary statistics, then notes)
          add.lines=list(c("Resource controls",
                           rep("No", 1),rep("Yes",5)),
                        c("Peer controls",
                           rep("No", 2),rep("Yes",4)),
                        c("Prefecture controls",
                           rep("No", 3),rep("Yes",3)),
                        c("Ability controls",
                           rep("No", 4),rep("Yes",2)),
                        c("Career paths controls",
                           rep("No", 5),rep("Yes",1))), # Add lines to describe in categories the series of variables included
          covariate.labels = c("Beginning Tenure", "End Tenure"),
          float = FALSE) # Rename labels of coefficients

# Note: Default type is Latex
```
# References
